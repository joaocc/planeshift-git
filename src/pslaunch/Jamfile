SubDir TOP src pslaunch ;

Application psupdater :
	[ Filter [ Wildcard *.cpp *.h ] : pslaunch.cpp pawslauncherwindow.cpp pslaunch.h pawslauncherwindow.h globals.h ] : console
;

if $(TARGET.OS) = "MACOS_X"
{
  if $(COMPILER.CFLAGS.SSE)
  {
    C++FLAGS on [ DoObjectGrist updaterengine$(SUFOBJ) ] += $(COMPILER.CFLAGS.SSE) ;
  }

  if $(COMPILER.CFLAGS.SSE2)
  {
    C++FLAGS on [ DoObjectGrist updaterengine$(SUFOBJ) ] += $(COMPILER.CFLAGS.SSE2) ;
  }
}

ExternalLibs psupdater : CRYSTAL ;
LinkWith psupdater : xdelta3 psutil xpnet ;

if $(HAVE_STATIC_PLUGINS) = "yes"
{

SubVariant updaterStatic ;
Application psupdater_static : [ Filter [ Wildcard *.cpp *.h ] : pslaunch.cpp pawslauncherwindow.cpp pslaunch.h pawslauncherwindow.h globals.h ] : console ;
CFlags psupdater_static : [ FDefines CS_STATIC_LINKED ] ;
LFlags psupdater_static : -lcrystalspace_staticplugins-1.3 ;
MsvcDefine psupdater_static : CS_STATIC_LINKED ;
LinkWith psupdater_static : xdelta3 psutil xpnet ;

if $(TARGET.OS) = "MACOS_X"
{
  if $(COMPILER.CFLAGS.SSE)
  {
    C++FLAGS on [ DoObjectGrist updaterengine$(SUFOBJ) ] += $(COMPILER.CFLAGS.SSE) ;
  }

  if $(COMPILER.CFLAGS.SSE2)
  {
    C++FLAGS on [ DoObjectGrist updaterengine$(SUFOBJ) ] += $(COMPILER.CFLAGS.SSE2) ;
  }
}

LinkStaticPlugins psupdater_static :
  vfs
: 
: CRYSTAL
;

ExternalLibs psupdater_static : CRYSTAL ;

SubVariant ;
}

SubVariant pslauncher ;
Application pslaunch :
	[ Filter [ Wildcard *.cpp *.h ] : updater.cpp updater.h ] :
;

if $(TARGET.OS) = "MACOS_X"
{
  if $(COMPILER.CFLAGS.SSE)
  {
    C++FLAGS on [ DoObjectGrist updaterengine$(SUFOBJ) ] += $(COMPILER.CFLAGS.SSE) ;
  }

  if $(COMPILER.CFLAGS.SSE2)
  {
    C++FLAGS on [ DoObjectGrist updaterengine$(SUFOBJ) ] += $(COMPILER.CFLAGS.SSE2) ;
  }
}

ExternalLibs pslaunch : CRYSTAL ;
CompileGroups pslaunch : client ;
LinkWith pslaunch : xdelta3 paws psutil fparser xpnet ;
SubVariant ;

if $(HAVE_STATIC_PLUGINS) = "yes"
{

SubVariant launcherStatic ;
Application pslaunch_static : [ Filter [ Wildcard *.cpp *.h ] : updater.cpp updater.h ] : ;
CFlags pslaunch_static : [ FDefines CS_STATIC_LINKED ] ;
LFlags pslaunch_static : -lcrystalspace_staticplugins-1.3 ;
MsvcDefine pslaunch_static : CS_STATIC_LINKED ;
LinkWith pslaunch_static : xdelta3 paws psutil fparser xpnet ;

if $(TARGET.OS) = "MACOS_X"
{
  if $(COMPILER.CFLAGS.SSE)
  {
    C++FLAGS on [ DoObjectGrist updaterengine$(SUFOBJ) ] += $(COMPILER.CFLAGS.SSE) ;
  }

  if $(COMPILER.CFLAGS.SSE2)
  {
    C++FLAGS on [ DoObjectGrist updaterengine$(SUFOBJ) ] += $(COMPILER.CFLAGS.SSE2) ;
  }
}

STATIC.PLUGINLIST = 
  engine
  fontplex
  imgplex
  vfs
  ;
  
STATIC.OPTIONALPLUGINLIST =
  ;

if $(TARGET.OS) != "WIN32"
{
    if $(TARGET.OS) != "MACOS_X"
    {
        if $(X11.AVAILABLE) = "yes" { STATIC.PLUGINLIST += xwin ; }
        if $(XFREE86VM.AVAILABLE) = "yes" { STATIC.PLUGINLIST += xext86vm ; }
        STATIC.OPTIONALPLUGINLIST += glx2d ;
    }
}
if $(TARGET.OS) = "WIN32" { STATIC.PLUGINLIST += glwin32 ; }
if $(TARGET.OS) = "MACOS_X" { STATIC.PLUGINLIST += glosx2d ; }

LinkStaticPlugins pslaunch_static : $(STATIC.PLUGINLIST)
: $(STATIC.OPTIONALPLUGINLIST)
: CRYSTAL
;

ExternalLibs pslaunch_static : CRYSTAL ;
CompileGroups pslaunch_static : client_static ;

SubVariant ;
}

