*** 2009-03-27 by Stefano Angeleri
- Completed the item prereq op. It takes two arguments: if it should search
  in the inventory or only in the equipment slots and the item name which
  can check also for renamed items.
  eg: <item inventory="true" name="Ubersword of Weltall the Klyros" />
- Added a function in psitem to search for items in equipment or the entire
  inventory for the specified item name. It returns true if it was found, false
  if it wasn't

*** 2009-03-27 by Andrew Dai
- Removed send trigger in netbase as this can prevent packets being merged
  together.
- Reduced the select timeout to 10ms since send trigger is removed and to
  reduce network lag.
- Changed minimum proxlist distance to be > 0.
- Made proxlist messages more informative.

*** 2009-03-25 by Andrew Dai
- Reduced lag on connections with packet loss by changing algorithm for
  resending packets to use Jacobson/Karels algorithm to estimate RTT and mean
  deviance in connections and use those to calculate a packet timeout for each
  individual client connection.
- Increased npcclient inqueue size to prevent packet drops on startup.
- Removed some pointless string copying in PAWS.
- Improved performance when checking for duplicated packets.
- Fixed bug in npcclient where duplicates would not be detected since the input
  queue was longer than the packet history so when the input queue fills up,
  dups would not be detected.

*** 2009-03-25 by Stefano Angeleri
- Added quality and maxquality in getsellprice() math script enviroment
  for coherence with getprice()

*** 2009-03-25 by Kenny Graunke
- Switched Clients to use csWeakRef<gemObject> target instead of a bare
  pointer, and removed ClientConnectionSet::ClearAllTargets.  I believe
  this should be safer.  May fix some obscure crashes.

*** 2009-03-24 by Keith Fulton
- Step 1 of supporting multiple voicing files for one response is to allow
  queueing and sequencing of the files.  This commit does that and demos it by playing 
  any voice file twice in a row.
- This commit along with a CS fix also should fix the memory leaks for sounds, where
  sound streams were constantly being added but never removed in the OpenAL renderer.

*** 2009-03-24 by Kenny Graunke
- Improved assertion messages in MathExpression::Evaluate.
- Lowered the precision of MathVar::ToString() to two decimal places, to bring
  spell messages in line with the precision of combat damage messages.
- Fixed a bug where NULL was being supplied to the Calculate Damage script as,
  TargetAttackWeapon.  This occured when the target had a non-weapon in their
  hand.  Yet, this is not sensible, because scripts don't check for NULL and
  just presume the object really exists.  Now we use "Fist", as if the hand
  was empty, so we get a real weapon with a small amount of blunt damage.
- Removed TARGET_NPC and TARGET_PVP target types.  Just use FRIEND or FOE.
  ==> DB VERSION BUMP: 1216 <==

*** 2009-03-24 by Stefano Angeleri
- Made newacct auto enable created accounts, additionally added an optional
  argument to define the security level of the account user/pass/seclevel
  default is security level 0

*** 2009-03-24 by Kenny Graunke
- Fixed an off-by-one bug in MathEnvironment::InterpolateString which caused
  it not to substitute for single letter variables like ${D}.
- Fixed a major bug in psSpellCastGameEvent, which somehow had two copies of
  PowerLevel, set one, and used the other.
- Fixed a major bug where PowerLevel, ChanceOfCastSuccess, and ManaCost were
  supplying numerical skill IDs rather than the character's actual skill rank.
- Converted psWay to use PSITEMSTATS_STAT instead of PSSKILL.
- Ported Borillis' code for the <animal-affinity> script operation to the new
  scripting system.  (It's needed for character creation.)

*** 2009-03-23 by Kenny Graunke
- Integrated RecalculateStats() and CalculateCosts() with Buffables.
- This fixes a bug where buffs were not affecting inventory weight limits,
  among other things.
- Fixed PS#920 by reverting a fix to PS#176 from 2007, then wrote a different
  fix for that bug.

*** 2009-03-20 by Stefano Angeleri
- Fixed a crash in the /guildinfo caused by the assumption the guild window 
  was always loaded, which is not the case if you aren't in a guild.

*** 2009-03-20 by Andrew Dai
- Fixed npcclient crashes that were referencing a deleted object in MeleeOperation.
- Fixed npcclient crash where script operations were not being reset completely when
  a npcobject is no longer being tracked.
- Also added EventManager reference to BehaviorSets.
- Made NPC AI ticks more flexible so that they are no longer grouped together.
- Increased NPC reactions by reducing delay to 200.
- Increased NPC position resolution by increasing DR updates from once per 2.5 seconds
  to once per 1.5 seconds.

*** 2009-03-19 by Andrew Dai
- Reduced network queue size for clients on server.
- Fixed uninitialized variable in SQL timing statements.
- Fixes to NPC chasing behaviour.
- Changed the CD out of bounds error to be fatal to pick up on nan errors earlier.
- Disables stamina for NPCs which fixes NPCs attacking back and chasing.

*** 2009-03-19 by Kenny Graunke
- Fixed a server crash when lockpicking.  GetSkillRank used to return 0 when
  given an invalid skill ID, but now it triggers an assertion.
- Fixed a bug in MathExpression's parser, which wasn't handling zero argument
  method calls correctly.  Fixes PS#2814.  Also added a unit test.
- Updated the loot generator for the new scripting system.
  It's still not ideal, but should work as well as it did before.
  ==> DB VERSION BUMP <==
- Added a MathScript accessor for character faction.

*** 2009-03-18 by Kenny Graunke
- Added assertions to catch problems earlier, where one might stand a chance
  at deciphering the actual issue.
- Updated fake version of "Flame Spire" to display the amount of damage.
  This should help with PS#818.

*** 2009-03-17 by Keith Fulton
- Made npc_knowledge_areas row in database unnecessary for the KA which is named
  after the NPC.  This enables quest_scripts to work without needed another row in 
  another table anywhere.  The now-redundant rows for specific named KAs in that table
  are harmless though and can stay.

*** 2009-03-17 by Kenny Graunke
- Sync'd CacheManager::CopyItemStats for the new 1214 DB schema.

*** 2009-03-16 by Kenny Graunke
- Fixed substantial memory leaks in the new scripting system.

*** 2009-03-14 by Stefano Angeleri
- Fixed PS#2798 - NPC items lose quality by setting all equipped items
  back to max quality on respawn.

*** 2009-03-14 by Kenny Graunke
- Fixes to the progression script schema:
  - Switched to <zeroOrMore> for imperative operations to support the
    "Nothing special" character creation options, which are <script></script>.
  - Made <else> optional.
- Made the type attribute optional on imperative <fx> (defaults to attached).
- Improved more error messages when scripts fail to load.
- Added spell table structure conversion to upgrade_schema.sql.

*** 2009-03-13 by Tristan Cragnolini
- Changed the virtual functions in gemObject, implemented in the derived
  classes, to get a pointer to the derived classes. They now are wrapper
  for dynamic_cast to the derived classes.

*** 2009-03-12 by Keith Fulton
- Implemented the riddle prompt functionality from the quest popup menus.
  Use:  Menu: ?=Question Reminder to script this functionality.
  Talk to the Merchant to get this puzzle quest and try it.  "blue" is the correct
  answer to the riddle.  It is quest script 210 if you want to see the example.
- Other warning fixes and data type fixes.

*** 2009-03-12 by Kenny Graunke
- Added MathScript accessors for HP, Mana, and Stamina.
- Fixed "Run script ..." in quests, which wasn't providing the script with the
  necessary actors.  Now it defines "NPC" and "Target" (the player).

*** 2009-03-12 by Stefano Angeleri
- Added attackable flag for gm. Players will be able to attack him like a mob
  but without kill steal protection. It's also the only way to use effectively
  givekillexp
- various improvements in gm gui
- fixed bugs in petition management
- Removed double spaces in /inspect
- Updates to the compiling guide
- Fixed tab width in the chardescription window by caarrie

*** 2009-03-10 by Kenny Graunke
- Converted Buffables to use csArray instead of csList to improve their
  efficiency (memory usage and cache behavior).

*** 2009-03-09 by Tristan Cragnolini
- Fixed PS#613 - You always receive group loot when you're in a guildhouse.  
                 Patch by Vornne
- Fixed PS#2799 - Server crash when uploading character, patch by Lanarel
- Improved the parsing in /rotate, taking into account first axis 
  parameter being 0
- Corrected a loss of target when using /slide or /rotate on items

*** 2009-03-08 by Kenny Graunke
- Fixed a crash when killing an NPC with the /death command.
- Fixed an underflow bug with skills and stats.

*** 2009-03-06 by Kenny Graunke
- Rewrote MathScript, ProgressionScript, and the magic system.

*** 2009-03-06 by Tristan Cragnolini
- Fixed PS#2795 - guarding range ignores instance

*** 2009-03-01 by Stefano Angeleri
- Committed a patch by peeg fixing some little issues in the chardescription
  editing window

*** 2009-03-01 by Stefano Angeleri
- Changed behaviour of the onlinetime prerequisite operator
  now you don't have to pass the type but works like factions so just
  pass max or min and if you need both and two onlinetime operators
- fixed some comments and cleaned up some code
- added Require guild [private/public/], Require not guild [private/public/],
  Require active magic [magicname], Require not active magic [magicname],
  Require known spell [spellname], Require not known spell [spellname],
  Require race [Racename as per db], Require not race [racename as per db],
  Require gender [male/female/neutral], Require not gender [male/female/neutral],
  Require married, Require not married to the quest script syntax allowing
  so more dynamic quests without doing many duplicates.

*** 2009-02-24 by Stefano Angeleri
- Updated gm gui to the new paws specifications
- Fixed PS#2785 - [pawscrollbar] Keeps scrolling undefinitely even when
  not clicking. pawsscrollbar onbuttonrelease() was forgot with the
  old definition and so it wasn't called anymore making scroll not work
  correctly while clicking on arrows.
- Placed a sleep in the main loop so the client doesn't take all the cpu
  in case no drawing is being done

*** 2009-02-23 by Tristan Cragnolini
- Fixed PS#2496 - Guild shows in an alliance 

*** 2009-02-22 by Tristan Cragnolini
- Fixed PS#2722 - Can't place money there
- Fixed  PS#2595 - pickup command should need a target

*** 2009-02-22 by Stefano Angeleri
- Removed a Show() in the groupwindow which would have displayed each
  time there were member changes the window disregarding the user choice
  to hide it (this made the window extremely annoying considering left/join
  notifications are already in chat)
- Added a language selection in pslaunch
- Updates to the italian language with new strings and additional
  translated strings

*** 2009-02-21 by Stefano Angeleri
- Updated the gm petition window to the new paws version and improved
  placements of parts of it
- Added a gm column in the gm petition window showing the gm who has claimed
  currently a petition
- Fix for PS#1714 - ability for gms to view all petitions even if claimed.
  By allowing all to see always all petitions, even claimed ones and only
  gm5+/devs can unclaim them, removed also some redundant code and variables
- Fix for PS#2775 - Petition notification - By requesting immediately the
  petitions and setting haspetinterest true, additionally changed the
  Petitions are waiting message to New petition from (name from the last
  petition submitted
- Change the OnButtonPressed to OnButtonReleased in the gm petition window

*** 2009-02-21 by Tristan Cragnolini
- Changed the array of emote in UserManager to be a hashmap
- merged the Validate() security level checking wrapper from adminmanager
  into HasAccess() from psserver, renamed HasAccess() to CheckAccess(),
  changed various commands in usermanager and adminmanager to use the new wrapper
- moved DecodeCommandArea() from UserManager and FindObjectByString()
  from AdminManager to msgmanager, where they will be easily reusable
  by both classes

*** 2009-02-20 by Stefano Angeleri
- Added instance sliding with /slide.
  The command is /slide (target) I slideamount, slide amount is relative
  the the current instance of the target

*** 2009-02-18 by Keith Fulton
- PAWS update
   1. Now syntax of <pawsButton bla.bla></pawsButton> is supported instead
      of cumbersome <widget factory="pawsButton" bla bla></widget> syntax.
   2. styles now work and support repeated tags.
   3. image definitions can now be horizontal or vertial "3-patches" where the
      middle part automatically tiles.  They can also be rectangular "9-patches"
      where the middle parts of the edges repeat on the edges and the middle part
      tiles in the middle to accommodate any widget size.  These can be used
      interchangeably wherever single images used to be used.
   4. CTRL-ALT-Click on the Close Box of a window now reloads that window xml file.
      This is not guaranteed not to crash the client but a lot better than exiting
      and reloading every time you tweak a widget position 1 pixel.
   5. Also changed the default button behavior to use OnButtonReleased, not OnButtonPressed.
      This equates to processing the button on mouse up, not mouse down, which is
      the way every GUI in the world works.  We need to change all windows to do
      this correctly.
   6. A number of windows have been redone to support the above.
- Miscellaneous fixes discovered during the above.
- Restyled Help Window and Spell Window

*** 2009-02-18 by Tristan Cragnolini
- Patch for PS#2744 by Loyni - ambient sound and voices options now
  treated separately, plus a fix to sound after the window lost focus.
- Patch for PS#2579 - the client was loading even though the slots
  were not correctly set up, and the server was accepting to place items
  in invalid slots.

*** 2009-02-15 by Stefano Angeleri
- Added a knownspell quest prerequisite operator
  eg: <knownspell spell="Darkness" />
  where spell is the name of the spell we are looking for
- Removed a non working and deprecated /confirmgroupjoin, fixes to
  /guildinfo and to the bugreport command patch by loyni

*** 2009-02-14 by Stefano Angeleri
- Changed the marriage quest prerequisite operator to be easier
  now it's just <married /> which will be true if the character is
  married and false if he isn't. To get the the inverse value as true
  (you want a not married character) just do <not><married /></not>

*** 2009-02-13 by Stefano Angeleri
- Added a marriage quest prerequisite operator
  eg: <marriage status="yes">
  status can be either yes or no. yes will return true if the character
  is married else false. no will return true if the character isn't
  married else false


*** 2009-02-11 by Kenny Graunke
- Patch for PS#2745 by Caarrie - the wrong sound resource was being used.
- Patch for PS#2745 by Loyni - fixes regressions in last fix for #2677.

*** 2009-02-09 by Stefano Angeleri
- Fixed PS#2677 - server crash on opening skill window  patch by loyni
- Fixed a bug in gender and race prerequiste operators
- Fixed missing icon during drag and drop patch by loyni

*** 2009-02-08 by Stefano Angeleri
- Added an advisor point quest prerequisite
  eg: <advisorpoint min="0" max="100" type="both"/>
  min and max are the minimum and maximum advisor points where
  the quest will be allowed to be taken
  Type can have 3 values:
  both = It means min and max will be taken in consideration
  min = It means min will be taken in consideration
  max = It means max will be taken in consideration
- Added a $time variable for npc texts which will be substituted to
  morning/afternoon/evening/night depending on the hour patch by Lanarel

*** 2009-02-08 by Stefano Angeleri
- Added an online time quest prerequisites 
  eg: <onlinetime min="0" max="100" type="both"/>
  min and max are the minimum and maximum online time where
  the quest will be allowed to be taken
  Type can have 3 values:
  both = It means min and max will be taken in consideration
  min = It means min will be taken in consideration
  max = It means max will be taken in consideration

﻿*** 2009-02-06 by Stefano Angeleri
- Added guild quest prerequisites eg: <guild type="public"/>
  These are the allowed values:
  none = the player isn't in a guild
  public = the player is in a public guild
  private = the player is in a private guild
  both = the player is in a guild, regardless of it's public status
- Removed duplicate code in pawsdetailwindow

*** 2009-02-05 by Stefano Angeleri
- Various fixes and clean ups by kougaro
- Completed work on the new descriptions
- Fixed an issue which would stop the player from editing his custom
  life events if there was nothing in the tab
- Added the possibility to add little scripts which will define dynamically
  generated life events based on the character faction points. The script
  must be ordered from the absolute highest value to the lowest one. The
  fact a number is negative doesn't matter so: 20 10 is correct, 20 -20
  10 -10 is correct, 10 -20 is correct but 10 20 -10 -20 and 20 10 -10 -20
  are wrong.
- Added some sample data to faction.sql to demonstrate the dynamic life
  events function, part of it was provided by Xillix
- Some commenting improvements
- Tab/spaces fixes
- Added race and gender quest prerequisites for race it's
  <race name="Klyros"/> for gender it's <gender type="M"/>

﻿*** 2009-02-03 by Stefano Angeleri
- Made the editable life event field working in editing and reading from
  the description
- Some improvements in comments

*** 2009-02-02 by Stefano Angeleri
- Added all-axis rotation support for items by kougaro
- Added a wrapper to check access to a certain command more easily by kougaro
- Changed hardcoded PI values to the Crystal Space provided PI define
- Added a faction_character column in the faction table which should store
  how the dinamyc faction should be applied in the life events of a character
- added a life_description column in character which holds the editable
  part of the char creation/life events tab in the character description

*** 2009-01-31 by Steven Patrick
- Fix to application title for linux, patch by Vornne.

*** 2009-01-28 by Steven Patrick
- Updated help.xml, patch by Caarrie.

*** 2009-01-26 by Dave Bentham
- Minigames: modified how game-player data is held to allow extensibility.

*** 2009-01-21 by Stefano Angeleri
- Added pid: in /pos extended output fixing PS#2680 - pos and info have
  differnet pos output, original patch by caarrie reworked by me
- Added the rest of the help text in the description

*** 2009-01-21
- Fixed PS#2368 - Add Map name to /info results, patch by kougaro.

*** 2009-01-19 by Keith Fulton
- Major upgrade to PAWS capabilities in this commit.  Most of this functionality
  was already here but unused or not working right.  Here is an explanation of
  what is possible, with pointers to examples:
    1. Anywhere an image is needed, you can now use a tilable stretchable image.
       This images can be made with 3 components to stretch horizontally, 3
       components to stretch vertically, or 9 components to stretch both directions.
       See the new imagelist.xml in default.zip for examples of these.
    2. PAWS styles now work much better.  In any <widget> tag you can specify
       style="whatever" and the xml for that style in /data/gui/styles.xml will
       be dropped into that widget.  This means anything can be overridden with
       styles.  Backgrounds, fonts, and the next feature.
    3. New widget subtag, <defaultstyle>.  This allows you to specify for a
       widget that any widget with the named factory should get the named style
       unless overridden locally.  For example:

          <defaultstyle factory="pawsButton" style="redbutton"/>

       If this is specified at a parent level, then all buttons in this widget
       will use the redbutton class without having to specify it each time.

       If this is specified inside a style, then any widget getting this style
       will use the "redbutton" style for any of this widget's buttons.

       By specifying defaultstyle's for many factories in a standard style,
       we should be able to pull out nearly ALL style information from the 
       widget definitions and only store them in 1 place.


*** 2009-01-19 by Steven Patrick
- Updated chat bubbles config for npcinternal, patch by Caarrie.
- Compiling.html fixes, patch by Caarrie.

*** 2009-01-19 by Keith Fulton
- Fixing chat bubbles so that both the npc bubbles and the player menu popups are
  displayed.
- Committed a fix by Nick Prassas (Loyni) for bug 2402.  Thanks Nick!
- Also committed a fix by Nick Prassas (Loyni) for bug 2691.  Thanks Nick!
  (Net Version bump)

*** 2009-01-15 by Kenny Graunke
- Implemented targeting by ItemID(*) for admin commands, i.e.
  "/teleport itemid:407 here".  This will be immensely useful when working
  with container ALs, as they only specify ItemID, not EID.
  
  (*) "ItemID" means psItem/item_instance UID, not item_stats.  If you find
      any incorrect uses, please rename them to "ItemStatsID" for clarity.

*** 2009-01-14 by Stefano Angeleri
- Comment fixes by kougaro
- Made npc rotate back to their original position after talking with
  them patch by kougaro
- fixed /inspect being cut by the packet size limit
- /deputize now allows devs to set up to their level differently than
  gm who keep the <their level - 1> rule

*** 2009-01-13 by Stefano Angeleri
- Changed tabs to spaces and trimmed ending spaces
- Added the possibility to load/save descriptions from file.
  They are stored in /description/char_name_description.txt and ca be
  easily loaded with a button from the char description editing window
  fixing PS#2434 - Loading-/Saving-functions for player descriptions 
- Committed patch by Electricsheep fixing
  PS#2632 - resizing the chardescription edit window. with some
  refactoring from me
- Updates to the compiling guide
- Added OOC tab help by doshot

*** 2009-01-10 by Keith Fulton
- Now PaladinJr will not report teleports or shifts as cheat moves.
- Restructured the allowed lag calculations significantly.  Khaki if you're out there
  your review would be appreciated.
- Left in the debug printf spam intentionally to help the testing team help me figure
  out where the remaining problems are.
- Final functor messaging conversion is completed.
- Renamed psWorkManager to WorkManager for consistency.  I think all the "ps" prefixes
  are now gone from the Manager level anyway.

*** 2009-01-10 by Stefano Angeleri
- Ignoring quest prereqs when questtester is set
- Made an error message in crafting more visible

*** 2009-01-07 by Steven Patrick
- Fixed FS#2458 : Make NPCs face player when talking, patch by kougaro.

*** 2009-01-07 by Dave Bentham
- Improved some GUI texts for minigames to distnguish between games
  and puzzles.

*** 2009-01-07 by Stefano Angeleri
- Fixed NPC camera collision detection it was skipping the code acting
  always as with collision detection disabled

*** 2009-01-06 by Keith Fulton
- Changed sector specifier in npc_spawn_ranges table to be a FK directly
  to the sectors table instead of a common string with the name of the sector
  in the string.  This is a tighter structure for this table.
  DB VERSION BUMP.
- On a side note, Aiken has tested this functionality and it does work.
  We should use it.
- Fixed crash if the speex plugin isn't available, which has the effect of the 
  file being found but the data still unable to be loaded (crashes the client).
- Fixed crash in npc /give check for frozen targetClient
- Now quests break up dialog into different say commands, one sentence at a time.
  The objective of this is to make the chat (and chat bubbles) more readable and
  give better pacing with the eventual audio files.

*** 2009-01-06 by Dave Bentham
- Progression scripts can be kicked by mini-games when won, by adding
  script='prog_script_name' to the action_location. In script terms, the
  winner = actor, loser = target.

*** 2009-01-06 by Stefano Angeleri
- Fixed FS#1548 - Battle Helms can be equipped in hands.
  The code replaced $H (which is used only for replacements for helms
  and most probably was intended so) only in case the helm was in the
  helm slot making it impossible to get the right mesh if you hold
  it in the hands for example. Also removed the definition of a psstring
  to use replaceallsubstring as the replaceall in crystal space csstring
  does already what's needed avoiding useless assignments and conversions

*** 2009-01-05 by Keith Fulton
- Now Paladin detects speed hacks and kicks you off the server if you run too quickly
  for more than a few seconds.  Needs to be tested more by the Testing team if
  possible for false positives mostly.
- New fixed version doesn't hardcode max speed to always be 1.  :)


*** 2009-01-04 by Stefano Angeleri
- Changed cordinates of the hide/show button in order to make it not
  move around when clicked (except style 2)
- Disabled Style change if the toolbar is hidden
- Added some descriptive tooltip on the hide/show button
- Fix for FS#673 - trias in skills panel not updated patch by kougaro

*** 2009-01-03 by Stefano Angeleri
- Lowered access level of /killnpc to gm2
- Added /assignfaction [target] [factioname] value for gm4+
  It allows to assign relative factions to targets
- Additional safety checks in drop by kougaro

*** 2009-01-02 by Dave Bentham
- Fixed bug FS#2498: invisible GMs can register in events now.

